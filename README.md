## Digital 101 Assignment - The Coffee Shop

### Database schema
```sql
-- The user table
CREATE TABLE public.tbl_user (
     id uuid NOT NULL,
     username varchar(50) NOT NULL,
     "password" varchar(255) NOT NULL,
     "role" varchar(20) NOT NULL,
     status varchar(20) NOT NULL,
     created_at timestamp DEFAULT now() NULL,
     CONSTRAINT tbl_user_pkey PRIMARY KEY (id),
     CONSTRAINT tbl_user_username_key UNIQUE (username)
);
CREATE INDEX idx_tbl_user_status ON public.tbl_user USING btree (status);
CREATE INDEX idx_tbl_user_username ON public.tbl_user USING btree (username);

-- The shop table
CREATE TABLE public.tbl_shop (
     id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
     "name" varchar(100) NOT NULL,
     address varchar(255) NOT NULL,
     phone varchar(20) NULL,
     latitude numeric(10, 8) NULL,
     longitude numeric(11, 8) NULL,
     max_queue_size int4 NOT NULL,
     number_of_queues int4 NOT NULL,
     created_at timestamp DEFAULT now() NULL,
     opening_day_of_week int4 NOT NULL,
     opening_time time NOT NULL,
     closing_time time NOT NULL,
     CONSTRAINT tbl_shop_pkey PRIMARY KEY (id)
);

-- The menu items table
CREATE TABLE public.tbl_menu_item (
      id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
      shop_id int8 NOT NULL,
      "name" varchar(100) NOT NULL,
      description text NULL,
      price numeric(10, 2) NOT NULL,
      is_available bool DEFAULT true NULL,
      CONSTRAINT tbl_menu_item_pkey PRIMARY KEY (id),
      CONSTRAINT fk_menu_items_shop FOREIGN KEY (shop_id) REFERENCES public.tbl_shop(id)
);

-- The customer table
CREATE TABLE public.tbl_customer (
     id uuid NOT NULL,
     user_id uuid NOT NULL,
     "name" varchar(100) NOT NULL,
     phone varchar(20) NOT NULL,
     address varchar(255) NULL,
     loyalty_score int4 DEFAULT 0 NULL,
     CONSTRAINT tbl_customer_phone_key UNIQUE (phone),
     CONSTRAINT tbl_customer_pkey PRIMARY KEY (id),
     CONSTRAINT fk_customers_user FOREIGN KEY (user_id) REFERENCES public.tbl_user(id)
);
CREATE INDEX idx_tbl_customer_phone ON public.tbl_customer USING btree (phone);


-- The order table
CREATE TABLE public.tbl_order (
      id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
      customer_id uuid NOT NULL,
      shop_id int8 NOT NULL,
      status varchar(20) NOT NULL,
      queue_number int4 NULL,
      queue_position int4 NULL,
      created_at timestamp DEFAULT now() NULL,
      CONSTRAINT tbl_order_pkey PRIMARY KEY (id),
      CONSTRAINT fk_orders_customer FOREIGN KEY (customer_id) REFERENCES public.tbl_customer(id),
      CONSTRAINT fk_orders_shop FOREIGN KEY (shop_id) REFERENCES public.tbl_shop(id)
);
CREATE INDEX idx_tbl_orders_customer_id ON public.tbl_order USING btree (customer_id);
CREATE INDEX idx_tbl_orders_shop_id ON public.tbl_order USING btree (shop_id);
CREATE INDEX idx_tbl_orders_status ON public.tbl_order USING btree (status);


-- The order items table
CREATE TABLE public.tbl_order_item (
       id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
       order_id int8 NOT NULL,
       menu_item_id int8 NOT NULL,
       quantity int4 NOT NULL,
       unit_price numeric(10, 2) NOT NULL,
       CONSTRAINT tbl_order_item_pkey PRIMARY KEY (id),
       CONSTRAINT fk_order_items_menu_item FOREIGN KEY (menu_item_id) REFERENCES public.tbl_menu_item(id),
       CONSTRAINT fk_order_items_order FOREIGN KEY (order_id) REFERENCES public.tbl_order(id)
);
```

### REQUIREMENTS
- Java >= 17
- Postgresql 15
- Postman for testing

### Build docker image
- Build application and package
```shell
mvn clean install
```
- Build docker image
```shell
 docker build -t digital101app .
```

### Run app using docker compose
Run the following command to run the app:
```shell
docker-compose up --detach
```

### Health check
```shell
http://localhost:8080/actuator/health
```

### Test scripts
Use the Postman scripts that are provided in the `test-scripts` folder.